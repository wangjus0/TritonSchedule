import * as cheerio from "cheerio";
import { Db } from "mongodb";
import { connectToDB } from "../db/connectToDB.js";
import { disconnectFromDB } from "../db/disconnectFromDB.js";
import { insertDB } from "../services/insertDB.js";
import { searchSubject } from "../utils/searchSubject.js";
const MEETING_TYPES = {
    LE: "Lecture",
    DI: "Discussions",
    MI: "Midterms",
    FI: "Final",
};
// TODO: Some of this codes don't exist
const UCSD_SUBJECT_CODES = [
    "AAPI",
    "AAS",
    "ANAR",
    "ANBI",
    "ANES",
    "ANSC",
    "ANTH",
    "ASTR",
    "AUD",
    "AWP",
    "BENG",
    "BGGN",
    "BGJC",
    "BGRD",
    "BGSE",
    "BIBC",
    "BICD",
    "BIEB",
    "BILD",
    "BIMM",
    "BIOM",
    "BIPN",
    "BISP",
    "BNFO",
    "CAT",
    "CCE",
    "CCS",
    "CENG",
    "CGS",
    "CHEM",
    "CHIN",
    "CINE",
    "CLAS",
    "CLIN",
    "CLRE",
    "CLSS",
    "CLX",
    "CMM",
    "COGR",
    "COGS",
    "COMM",
    "CONT",
    "COSE",
    "CSE",
    "CSS",
    "DDPM",
    "DERM",
    "DOC",
    "DSC",
    "DSE",
    "DSGN",
    "EAP",
    "ECE",
    "ECON",
    "EDS",
    "EIGH",
    "EMED",
    "ENG",
    "ENVR",
    "ERC",
    "ESYS",
    "ETHN",
    "ETIM",
    "EXPR",
    "FILM",
    "FMPH",
    "FPM",
    "GLBH",
    "GMST",
    "GPCO",
    "GPEC",
    "GPGN",
    "GPIM",
    "GPLA",
    "GPPA",
    "GPPS",
    "GSS",
    "HDP",
    "HDS",
    "HIAF",
    "HIEA",
    "HIEU",
    "HIGL",
    "HIGR",
    "HILA",
    "HILD",
    "HINE",
    "HISA",
    "HISC",
    "HITO",
    "HIUS",
    "HLAW",
    "HMNR",
    "HUM",
    "ICEP",
    "INTL",
    "IRLA",
    "JAPN",
    "JWSP",
    "LATI",
    "LAWS",
    "LHCO",
    "LIAB",
    "LIDS",
    "LIEO",
    "LIFR",
    "LIGM",
    "LIGN",
    "LIHI",
    "LIHL",
    "LIIT",
    "LIPO",
    "LISL",
    "LISP",
    "LTAF",
    "LTAM",
    "LTCH",
    "LTCO",
    "LTCS",
    "LTEA",
    "LTEN",
    "LTEU",
    "LTFR",
    "LTGK",
    "LTGM",
    "LTIT",
    "LTKO",
    "LTLA",
    "LTRU",
    "LTSP",
    "LTTH",
    "LTWL",
    "LTWR",
    "MAE",
    "MATH",
    "MATS",
    "MBC",
    "MCWP",
    "MDE",
    "MED",
    "MES",
    "MGT",
    "MGTA",
    "MGTF",
    "MGTP",
    "MMW",
    "MSED",
    "MSP",
    "MUIR",
    "MUS",
    "NANO",
    "NEU",
    "NEUG",
    "OBG",
    "OPTH",
    "ORTH",
    "PAE",
    "PATH",
    "PEDS",
    "PH",
    "PHAR",
    "PHB",
    "PHIL",
    "PHLH",
    "PHYA",
    "PHYS",
    "POLI",
    "PSY",
    "PSYC",
    "RAD",
    "RELI",
    "REV",
    "RMAS",
    "RMED",
    "SE",
    "SEV",
    "SIO",
    "SIOB",
    "SIOC",
    "SIOG",
    "SOCE",
    "SOCG",
    "SOCI",
    "SOCL",
    "SOMC",
    "SOMI",
    "SPPH",
    "SPPS",
    "SURG",
    "SXTH",
    "SYN",
    "TDAC",
    "TDDE",
    "TDDM",
    "TDDR",
    "TDGE",
    "TDGR",
    "TDHD",
    "TDHT",
    "TDMV",
    "TDPF",
    "TDPR",
    "TDPW",
    "TDTR",
    "TKS",
    "TMC",
    "UROL",
    "USP",
    "VIS",
    "WARR",
    "WCWP",
    "WES",
];
function sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
}
// TODO: Server-side by UCSD is rate limiting, so prolly have to use puppteer
// to gather class data and cron by using the puppteer script
export async function scrapeFullTerm(new_term) {
    // have a list with all the subjects
    // reuse search function for each subject
    // have some function to add to database
    let db = await connectToDB();
    for (const subject of UCSD_SUBJECT_CODES) {
        await sleep(5000);
        let currentScraped = await searchSubject(subject, new_term);
        if (currentScraped.length > 0) {
            await insertDB(db, currentScraped, "courses");
        }
    }
    await disconnectFromDB();
    return;
}
// NOTE: testing
scrapeFullTerm("WI26");
